{# templates/utilisateurs/moncompte.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Mon compte | EcoRide{% endblock %}

{% block body %}
<div class="container mt-5" style="max-width:600px;">
  <h2 class="mb-4">Mon compte</h2>
  <div id="accountInfo" class="text-center">
    Chargement de vos informations…
  </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const token = localStorage.getItem('ecoride_token');

  if (!token) {
    console.warn('Pas de token, redirection vers login');
    return window.location.href = '{{ path("connexion") }}';
  }

  try {
    const resp = await fetch('{{ path("api_utilisateurs_profil") }}', {
      headers: { 'X-AUTH-TOKEN': token }
    });

    if (!resp.ok) {
      console.warn('Token invalide ou autre, nettoyage et redirection');
      localStorage.removeItem('ecoride_token');
      return window.location.href = '{{ path("connexion") }}';
    }

    const u = await resp.json();

    document.getElementById('accountInfo').innerHTML = `
      <ul class="list-group">
        <li class="list-group-item"><strong>Prénom :</strong> ${u.prenom}</li>
        <li class="list-group-item"><strong>Nom :</strong> ${u.nom}</li>
        <li class="list-group-item"><strong>Email :</strong> ${u.email}</li>
        <li class="list-group-item"><strong>Ville :</strong> ${u.ville}</li>
        <li class="list-group-item"><strong>Naissance :</strong> ${new Date(u.dateNaissance).toLocaleDateString('fr-FR')}</li>
        <li class="list-group-item"><strong>Crédit :</strong> ${u.credit}</li>
      </ul>
    `;
  } catch (err) {
    console.error('Erreur Mon Compte:', err);
    document.getElementById('accountInfo').textContent = 'Erreur lors du chargement';
  }
});
</script>
{% endblock %}
