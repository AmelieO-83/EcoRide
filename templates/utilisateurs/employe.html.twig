{# templates/utilisateurs/employe.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Profil employé – Validation des avis | EcoRide{% endblock %}

{% block body %}
  <div class="container mt-5">
    <h1>Avis à valider</h1>
    <ul id="avisList" class="list-group"></ul>
  </div>
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const token = localStorage.getItem('ecoride_token');
  if (!token) {
    return window.location.href = '{{ path("connexion") }}';
  }

  // 1. Récupère les avis
  let avis;
  try {
    const resp = await fetch('{{ path("api_avis_list") }}', {
      headers: {
        'X-AUTH-TOKEN': token,
        'Accept': 'application/json'
      }
    });
    if (!resp.ok) throw new Error();
    avis = await resp.json();
  } catch {
    document.getElementById('avisList').innerHTML =
      '<div class="alert alert-danger">Impossible de charger les avis.</div>';
    return;
  }

  const container = document.getElementById('avisList');
  if (avis.length === 0) {
    container.innerHTML =
      '<div class="alert alert-info">Aucun avis en attente de validation.</div>';
    return;
  }

  // 2. On génère chacun avec un lien /employe/avis/{id}
  container.innerHTML = avis.map(a => `
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>${a.note}/5</strong> par ${a.auteur.prenom}<br>
        <small>${a.commentaire}</small>
      </div>
      <div>
        <a href="/employe/avis/${a.id}" class="btn btn-primary btn-sm">
          Détails
        </a>
      </div>
    </li>
  `).join('');
});
</script>
{% endblock %}
